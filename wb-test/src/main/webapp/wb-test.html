<!DOCTYPE HTML>
<html>
  <head>
  
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
      canvas {
        border: 1px solid #9C9898;
      }
    </style>

    <script src="jquery-1.7.1.js"></script>
    
    <script src="wb-proto.js"></script>
    
    <script src="wb-common.js"></script>
    
    <script src="wb-script.js"></script>
    <script src="wb-soundfx.js"></script>
    <script src="wb-speech.js"></script>
    <script src="wb-pointer.js"></script>
    <script src="wb-board.js"></script>
    
    <script src="wb-shape.js"></script>
    <script src="wb-image.js"></script>
    <script src="wb-segment.js"></script>
    <script src="wb-path.js"></script>
    <script src="wb-curve.js"></script>
    <script src="wb-basicshapes.js"></script>
    <script src="wb-text.js"></script>
    <script src="wb-eraser.js"></script>
    <script src="wb-pan.js"></script>
    
    <script src="wb-parser.js"></script>
    <script src="wb-player.js"></script>
    <script src="wb-stepper.js"></script>

  </head>

  <body>
  
	<div id="toolbar" style="width: 720px;">
		<a href="javascript:void(0);" onclick="soundfx1()">SoundFX 1</a>
		<a href="javascript:void(0);" onclick="draw1()">Draw 1</a>
		<a href="javascript:void(0);" onclick="segment1()">Segment 1</a>
		<a href="javascript:void(0);" onclick="path1()">Path 1</a>
		<a href="javascript:void(0);" onclick="transform1()">Transform 1</a>
		<a href="javascript:void(0);" onclick="parse1()">Parse 1</a>
		<a href="javascript:void(0);" onclick="anim1()">Anim 1</a>
		<a href="javascript:void(0);" onclick="animRect1()">Anim Rect 1</a>
		<a href="javascript:void(0);" onclick="arc1()">Arc 1</a>
		<a href="javascript:void(0);" onclick="arc2()">Arc 2</a>
		<a href="javascript:void(0);" onclick="arc2anim()">Arc 2 Anim</a>
		<a href="javascript:void(0);" onclick="cubic1()">Cubic 1</a>
		<a href="javascript:void(0);" onclick="quad1()">Quad 1</a>
		<a href="javascript:void(0);" onclick="cloud1()">Cloud 1</a>
		<a href="javascript:void(0);" onclick="text1()">Text 1</a>
		<a href="javascript:void(0);" onclick="text1anim()">Text 1 Anim</a>
		<a href="javascript:void(0);" onclick="eq1()">EQ 1</a>
		<a href="javascript:void(0);" onclick="eq1anim()">EQ 1 Anim</a>
		<a href="javascript:void(0);" onclick="eq1step()">EQ 1 Step</a>
		<a href="javascript:void(0);" onclick="letterH1()">Letter H</a>
		<a href="javascript:void(0);" onclick="speech1()">Speech 1</a>
		<a href="javascript:void(0);" onclick="eraser1()">Eraser 1</a>
		<a href="javascript:void(0);" onclick="pan1()">Pan 1</a>

		<br/>
		<a href="javascript:void(0);" onclick="script1()">Script 1</a>
		<a href="javascript:void(0);" onclick="script1Stepper()">Script 1 Stepper</a>
		<a href="javascript:void(0);" onclick="script1Recorder()">Script 1 Recorder</a>
		
		<br/>
		<a href="javascript:void(0);" onclick="script2()">Script 2</a>
		<a href="javascript:void(0);" onclick="script3()">Script 3</a>
		
		<br/>
		<a href="javascript:void(0);" onclick="image1()">Image 1</a>
		<a href="javascript:void(0);" onclick="image1anim()">Image 1 Anim</a>
	</div>
	
	<div id="status" style="border: 1px solid gray; margin: 4px; width: 720px;">
		status
	</div>
	
	<div id="bottombar" style="border: 1px solid gray; margin: 4px; width: 720px;">
	</div>
	
	<div id="container" style="position: relative; margin: 4px; padding: 0; width: 720px; height: 405px;">
		<canvas id="bgCanvas" width="720" height="405" style="position: absolute; margin: 0; width: 720px; height: 405px; z-index: 1;"></canvas>
		<!--
		<canvas id="gridCanvas" width="720" height="405" style="position: absolute; margin: 0; width: 720px; height: 405px; z-index: 5;"></canvas>
		-->
		<canvas id="canvas" width="720" height="405" style="position: absolute; margin: 0; width: 720px; height: 405px; z-index: 11;"></canvas>
		<canvas id="animCanvas" width="720" height="405" style="position: absolute; margin: 0; width: 720px; height: 405px; z-index: 12;"></canvas>
		<canvas id="pointerCanvas" width="720" height="405" style="position: absolute; margin: 0; width: 720px; height: 405px; z-index: 13;"></canvas>
	</div>

	<script>
	
		function status(s) {
			$('#status').text(s);
		}

		function grid() {
			var canvas = document.getElementById('gridCanvas');
			if (!canvas) {
				return;
			}
			
			var context = canvas.getContext('2d');
			var width = canvas.width;
			var height = canvas.height;
			var delta = 50;
			for (var x = delta; x < width; x += delta) {
				context.beginPath();
				context.moveTo(x, 0);
				context.lineTo(x, height);
				context.lineWidth = 0.7;
				//context.strokeStyle = 'rgba(220,220,220,0.5)';
				context.strokeStyle = 'rgba(0,255,0,1)';
				context.stroke();
				for (var y = delta; y < height; y += delta) {
					context.beginPath();
					context.moveTo(0, y);
					context.lineTo(width, y);
					context.lineWidth = 0.7;
					//context.strokeStyle = 'rgba(220,220,220,0.1)';
					context.strokeStyle = 'rgba(0,255,0,1)';
					context.stroke();
				}
			}
		}
		
		grid();
		
		function soundfx1() {
			status('Running DrawingSoundEngine...');
			
			var soundEngine = new WB.DrawingSoundEngine();
			status('Engine: ' + soundEngine);
			
			status('normal');
			soundEngine.update({height: 0, velocity: 100});
			
			for (var i = 0; i < 10; i++) {
				setTimeout(function() {
					var speed = Math.random() * 400;
					if (speed < 25) {
						speed = 0;
					}
					status('speed: ' + speed);
					soundEngine.update({height: 0, velocity: speed});
				}, 2000 * (i + 1));
			}

			setTimeout(function() {
				status('speed: 0 - stop');
				soundEngine.update({height: 0, velocity: 0});
			}, 2000 * (10 + 1));
		}
		
		function draw1() {
			
			var pane = new WB.Pane({canvas: document.getElementById('canvas')});
	
			var Shape1 = WB.Class.extend('Shape1', {
				draw: function(pane) {
					console.log('Shape1 at ' + pane);
					pane.moveTo({x: 10, y: 10});
					pane.lineTo({x: 100, y: 100});
					pane.stroke();
				}
			});
			
			var shape = new Shape1();
			shape.draw(pane);
		}
		
		function segment1() {
			
			var pane = new WB.Pane({canvas: document.getElementById('canvas')});
			
			new WB.MoveToSegment({point: {x: 10, y: 10}}).outline(pane);
			new WB.LineToSegment({point: {x: 100, y: 100}}).outline(pane);
	
			pane.stroke();
		}
	
		function path1() {
			
			var pane = new WB.Pane({canvas: document.getElementById('canvas')});
			pane.context.scale(0.5, 0.5);
			pane.context.translate(pane.canvas.width, pane.canvas.height);
			
			var path = new WB.PathShape({
					segments: [
						new WB.MoveToSegment({point: {x: 10, y: 10}}),
						new WB.LineToSegment({point: {x: 100, y: 100}}),
						new WB.LineToSegment({point: {x: 100, y: 200}}),
						new WB.LineToSegment({point: {x: 10, y: 10}})
						]
				});
			
			path.draw(pane);
		}
		
		function transform1() {
			
			var pane = new WB.Pane({canvas: document.getElementById('canvas')});

			var path = new WB.PathShape({
				segments: [
					new WB.MoveToSegment({point: {x: 10, y: 10}}),
					new WB.LineToSegment({point: {x: 100, y: 100}}),
					new WB.LineToSegment({point: {x: 100, y: 200}}),
					new WB.LineToSegment({point: {x: 10, y: 10}})
					]
			});
			
			// normal
			path.draw(pane);
			
			var tr;

			// move
			tr = new WB.Transform();
			tr.translate(100, 100);
			pane.withTr(tr, function() {
				path.draw(pane);
				
				/*
				// move + scale + rotate
				tr = new WB.Transform();
				tr.translate(100, 0);
				tr.scale(0.5, 0.5);
				tr.rotate(WB.Geom.rad(45));
				pane.withTr(tr, function() {
					path.draw(pane);
				});
				*/
			});
		}
		
		function parse1() {
			
			var parser = new WB.Parser();
			
			var pathJson = {
				_type: 'PathShape',
				segments: [
					{
						_type: 'MoveToSegment',
						point: {x: 10, y: 10} 
					},
					{
						_type: 'LineToSegment',
						point: {x: 100, y: 100}
					},
					{
						_type: 'LineToSegment',
						point: {x: 100, y: 200}
					},
					{
						_type: 'LineToSegment',
						point: {x: 10, y: 10}
					}
				]
			};
			
			var groupJson = {
				_type: 'GroupShape',
				transform: new WB.Transform().translate(100, 0).rotate(WB.Geom.rad(45)),
				shapes: [pathJson]
			};
			
			var shape = parser.parse(groupJson);

			var pane = new WB.Pane({canvas: document.getElementById('canvas')});
			shape.draw(pane);
		}

		
		function bindPlayer(player) {
			
			$('#bottombar').html('<a href="javascript:void(0);"></a>');
			var a = $('#bottombar a');
			a.click(function() {
				if (player.state == 'playing') {
					player.suspend();
				} else {
					player.resume();
				}
			});

			player.bind(function(event, opts) {
				if (event == 'frame') {
					var p = player.board.animationPane.getCurrentPoint();
					status('Time: ' + (opts.time) + ' milliseconds' 
							+ '; Position: ' + Math.round(p.x) + ',' + Math.round(p.y));
				} else if (event == 'state') {
					if (opts.state == 'playing') {
						a.text('Suspend');
					} else if (opts.state == 'suspended') {
						a.text('Resume');
					} else if (opts.state == 'ended') {
						$('#bottombar').html('Finished');
					}
				}
			});
		}
		
		function playAny(animable, opts) {
			
			if (!opts) {
				opts = {};
			}
			
			var canvasStyle = 'ipad';
			
			// 720 x 405
			var canvasWidth = 720;
			var canvasHeight = 405;
			var realWidth = 1440; // mm
			var realHeight = 810; // mm
			
			var baseVelocity = 1000;
			if (opts.baseVelocity) {
				baseVelocity = opts.baseVelocity;
			}
			
			var defaultTransform = new WB.Transform();
					//.scale(canvasWidth/realWidth, canvasHeight/realHeight)
					//.translate(realWidth/2, realHeight/2);
			
			var strokeStyle;
			var pointerStyle;
			var bgCanvas = document.getElementById('bgCanvas');
			if (canvasStyle == 'whiteboard') {
				// leave it white or near white
				strokeStyle = 'black';
				pointerStyle = 'HandPoint';
			} else if (canvasStyle == 'blackboard') {
				var ctx = bgCanvas.getContext('2d');
				ctx.fillStyle = '#221d1d';
				ctx.fillRect(0, 0, canvasWidth, canvasHeight);
				strokeStyle = 'white';
				pointerStyle = 'HandChalkPoint';
			} else if (canvasStyle == 'greenboard') {
				var ctx = bgCanvas.getContext('2d');
				ctx.fillStyle = '#2e8244';
				ctx.fillRect(0, 0, canvasWidth, canvasHeight);
				strokeStyle = 'white';
				pointerStyle = 'HandChalkPoint';
			} else if (canvasStyle == 'ipad') {
				strokeStyle = 'black';
				pointerStyle = 'SwiperPoint';
			}
			
			var board = new WB.Board({
				commitPane: new WB.Pane({
					_desc: 'CommitPane',
					canvas: document.getElementById('canvas'),
					strokeStyle: strokeStyle,
					defaultTransform: defaultTransform
					}),
				animationPane: new WB.Pane({
					_desc: 'AnimationPane',
					canvas: document.getElementById('animCanvas'), 
					strokeStyle: strokeStyle,
					defaultTransform: defaultTransform
					}),
				drawingSoundEngine: new WB.DrawingSoundEngine({
					//baseVelocity: baseVelocity
					}),
				pointer: new WB[pointerStyle]({
					pane: new WB.Pane({
						_desc: 'PointerPane',
						canvas: document.getElementById('pointerCanvas'),
						defaultTransform: defaultTransform
						})
					}),
				speechPlayer: new WB.SpeechPlayer({urlResolver: opts.urlResolver}),
				urlResolver: opts.urlResolver,
				baseVelocity: baseVelocity,
				showBounds: false
				});
			
			board.commitPane._clearCanvas();
			board.animationPane._clearCanvas();
			board.pointer.pane._clearCanvas();
			
			var player = new WB.Player({board: board, framer: opts.framer});
			bindPlayer(player);

			player.playAny(animable);
		}
		
		function playScript(scriptId) {
			
			var urlResolver = function(path) {
				if (path.substr(0,1) != '/') {
					path = '/' + path;
				}
				return '/wb/' + scriptId + path;
			}

			$.ajax({url: urlResolver('script.json'), contentType: 'application/json'})
			.done(function(json) {
				console.log('got data');
				if (json) {
					if (json.constructor == String) {
						json = JSON.parse(json);
					}
					console.log(json);
					
					var parser = new WB.Parser();
					var script = parser.parse(json);
					console.log(script);
					
					playAny(new WB.EpisodeList({episodes: script.episodes, pause: 100}),
							{urlResolver: urlResolver});
				}
			});
		}
		

		function stepAny(animable, opts) {
			
			if (!opts) {
				opts = {};
			}
			
			WB.interceptor = function(obj, fnName, fn, args) {
				if (fnName != 'frame') {
					return fn.apply(obj, args);
				}
				
				var s = '' + obj._type + ' ' + args[0];
				console.log('Frame ' + s);
				var ret = fn.apply(obj, args);
				console.log('-> ' + s + ': ' + obj.isDone() + '; ' + obj.getTimeLeft());
				return ret;
			};
			
			// 720 x 405
			var canvasWidth = 720;
			var canvasHeight = 405;
			var realWidth = 1440; // mm
			var realHeight = 810; // mm
			
			var baseVelocity = 500;
			if (opts.baseVelocity) {
				baseVelocity = opts.baseVelocity;
			}
			
			var defaultTransform = new WB.Transform();
					//.scale(canvasWidth/realWidth, canvasHeight/realHeight)
					//.translate(realWidth/2, realHeight/2);
					
			var speechPlayer = new WB.SpeechPlayerPseudo({urlResolver: opts.urlResolver});
			
			var board = new WB.Board({
				commitPane: new WB.Pane({
					canvas: document.getElementById('canvas'), 
					defaultTransform: defaultTransform
					}),
				animationPane: new WB.Pane({
					canvas: document.getElementById('animCanvas'), 
					defaultTransform: defaultTransform
					}),
//				drawingSoundEngine: new WB.DrawingSoundEngine({
//					//baseVelocity: baseVelocity
//					}),
				pointer: new WB.HandPoint({
					pane: new WB.Pane({
						canvas: document.getElementById('pointerCanvas'),
						defaultTransform: defaultTransform
						})
					}),
				speechPlayer: speechPlayer,
				urlResolver: opts.urlResolver,
				baseVelocity: baseVelocity,
				showBounds: false
				});
			
			board.commitPane._clearCanvas();
			board.animationPane._clearCanvas();
			board.pointer.pane._clearCanvas();

			$('#bottombar').html('<span class="Loading">Loading...</span><a class="StepAction" href="javascript:void(0);">Step</a>');
			$('#bottombar .Loading').css('display', 'inline');
			$('#bottombar a.StepAction').css('display', 'none');

			var stepper = new WB.Stepper({board: board, interval: 10000});
			$('#bottombar a.StepAction').click(function() {
				//debugger;
				stepper.step();
				if (stepper.state == 'ended') {
					$('#bottombar').html('Finished');
				}
			});
			stepper.bind(function(event, opts) {
				if (event == 'frame') {
					var p = stepper.board.animationPane.getCurrentPoint();
					status('Time: ' + (opts.time) + ' milliseconds' 
							+ '; Position: ' + Math.round(p.x) + ',' + Math.round(p.y));
				}
			});

			stepper.start(animable);
			$('#bottombar a.StepAction').css('display', 'inline');
			$('#bottombar .Loading').css('display', 'none');
		}
		
		function stepScript(scriptId) {
			
			var urlResolver = function(path) {
				if (path.substr(0,1) != '/') {
					path = '/' + path;
				}
				return '/wb/' + scriptId + path;
			}

			$.ajax({url: urlResolver('script.json'), contentType: 'application/json'})
			.done(function(json) {
				console.log('got data');
				if (json) {
					if (json.constructor == String) {
						json = JSON.parse(json);
					}
					console.log(json);
					
					var parser = new WB.Parser();
					var script = parser.parse(json);
					console.log(script);
					
					stepAny(new WB.EpisodeList({episodes: script.episodes, pause: 100}),
							{urlResolver: urlResolver});
				}
			});
		}

		
		function recordAny(animable, opts, recordId) {
			
			if (!opts) {
				opts = {};
			}
			
			// 720 x 405
			var canvasWidth = 720;
			var canvasHeight = 405;
			var realWidth = 1440; // mm
			var realHeight = 810; // mm
			
			var baseVelocity = 500;
			if (opts.baseVelocity) {
				baseVelocity = opts.baseVelocity;
			}
			
			var defaultTransform = new WB.Transform();
					//.scale(canvasWidth/realWidth, canvasHeight/realHeight)
					//.translate(realWidth/2, realHeight/2);
					
			var speechPlayer = new WB.SpeechPlayerPseudo({urlResolver: opts.urlResolver});
			
			var board = new WB.Board({
				commitPane: new WB.Pane({
					canvas: document.getElementById('canvas'), 
					defaultTransform: defaultTransform
					}),
				animationPane: new WB.Pane({
					canvas: document.getElementById('animCanvas'), 
					defaultTransform: defaultTransform
					}),
//				drawingSoundEngine: new WB.DrawingSoundEngine({
//					//baseVelocity: baseVelocity
//					}),
				pointer: new WB.HandPoint({
					pane: new WB.Pane({
						canvas: document.getElementById('pointerCanvas'),
						defaultTransform: defaultTransform
						})
					}),
				speechPlayer: speechPlayer,
				urlResolver: opts.urlResolver,
				baseVelocity: baseVelocity,
				showBounds: false
				});
			
			board.commitPane._clearCanvas();
			board.animationPane._clearCanvas();
			board.pointer.pane._clearCanvas();

			$('#bottombar').html('Loading...');

			var stepper = new WB.Stepper({board: board, interval: 10000});
			stepper.bind(function(event, opts) {
				if (event == 'frame') {
					var p = stepper.board.animationPane.getCurrentPoint();
					status('Time: ' + (opts.time) + ' milliseconds' 
							+ '; Position: ' + Math.round(p.x) + ',' + Math.round(p.y));
				}
			});
			
			stepper.start(animable);
			$('#bottombar').html('Recoding...');

			var commitCanvas = board.commitPane.canvas;
			var animCanvas = board.animationPane.canvas;
			var pointerCanvas = board.pointer.pane.canvas;
			
			var canvasWidth = commitCanvas.width;
			var canvasHeight = commitCanvas.height;
			
			var frameIndex = 0;
			while (stepper.state == 'playing') {
				stepper.step();
				frameIndex++;
				
				var frame = {
					state: board._state,
					speech: speechPlayer.playingUrl,
					width: canvasWidth,
					height: canvasHeight,
					panes: [
				        {id:'commit', data:commitCanvas.toDataURL()},
				        {id:'animation', data:animCanvas.toDataURL()},
				        {id:'pointer', data:pointerCanvas.toDataURL()},
			        ]
				};
				
				$.ajax({
					type: 'POST',
					url: '/wb/service/recorder/frame?recordId=' + recordId + '&frameIndex=' + frameIndex,
					contentType: 'application/json',
					processData: false,
					data: JSON.stringify(frame)
				});
			}
		}
		
		function recordScript(scriptId) {
			
			var urlResolver = function(path) {
				if (path.substr(0,1) != '/') {
					path = '/' + path;
				}
				return '/wb/' + scriptId + path;
			}

			$.ajax({url: urlResolver('script.json'), contentType: 'application/json'})
			.done(function(json) {
				console.log('got data');
				if (json) {
					if (json.constructor == String) {
						json = JSON.parse(json);
					}
					console.log(json);
					
					var parser = new WB.Parser();
					var script = parser.parse(json);
					console.log(script);
					
					$.ajax({url: '/wb/service/recorder/start', contentType: 'application/json'})
					.done(function(json) {
						if (json.constructor == String) {
							json = JSON.parse(json);
						}
						console.log(json);
						
						var recordId = json.id;
						console.log('record id = ' + recordId);
						recordAny(new WB.EpisodeList({episodes: script.episodes, pause: 100}),
								{urlResolver: urlResolver},
								recordId);
					});
				}
			});
		}
		
		
		function anim1() {
			
			// 720 x 405
			var canvasWidth = 720;
			var canvasHeight = 405;
			var realWidth = 1440; // mm
			var realHeight = 810; // mm
			
			var defaultTransform = new WB.Transform()
					.scale(canvasWidth/realWidth, canvasHeight/realHeight)
					.translate(realWidth/2, realHeight/2);
			
			/*
			var p = new WB.Pane({canvas: document.getElementById('canvas'), 
				defaultTransform: defaultTransform});
			p.beginPath();
			p.moveTo({x: 0, y: 0});
			p.lineTo({x: 100, y: 100});
			p.stroke();
			console.log('1: loc: ' + JSON.stringify(p.getCurrentPoint()));
			console.log('1: glob: ' + JSON.stringify(p.getCurrentPoint(true)));
			
			var tr = new WB.Transform()
				.translate(100, 0);
			p.withTr(tr, function() {
				p.beginPath();
				p.moveTo({x: 0, y: 0});
				p.lineTo({x: 200, y: 100});
				p.stroke();
				console.log('2: loc: ' + JSON.stringify(p.getCurrentPoint()));
				console.log('2: glob: ' + JSON.stringify(p.getCurrentPoint(true)));
			});

			p.beginPath();
			p.moveTo({x: 0, y: 0});
			p.lineTo({x: 200, y: 100});
			p.stroke();
			console.log('3: loc: ' + JSON.stringify(p.getCurrentPoint()));
			console.log('3: glob: ' + JSON.stringify(p.getCurrentPoint(true)));
			return;
			*/
			
			var board = new WB.Board({
				commitPane: new WB.Pane({canvas: document.getElementById('canvas'), 
											defaultTransform: defaultTransform}),
				animationPane: new WB.Pane({canvas: document.getElementById('animCanvas'), 
											defaultTransform: defaultTransform}),
				});
			
			var path = new WB.PathShape({
				segments: [
					new WB.MoveToSegment({point: {x: 0, y: 0}}),
					new WB.LineToSegment({point: {x: 100, y: 100}}),
					new WB.LineToSegment({point: {x: 100, y: 200}}),
					new WB.LineToSegment({point: {x: 0, y: 0}})
					]
			});

			var player = new WB.Player({board: board});
			
			var group = new WB.GroupShape({
				transform: new WB.Transform().scale(2, 2),
				shapes: [path]
			});
			
			player.playAny(path, function() {
				player.playAny(group);
			});
		}
		
		function animRect1() {
			
			// 720 x 405
			var canvasWidth = 720;
			var canvasHeight = 405;
			var realWidth = 1440; // mm
			var realHeight = 810; // mm
			
			var defaultTransform = new WB.Transform()
					.scale(canvasWidth/realWidth, canvasHeight/realHeight)
					.translate(realWidth/2, realHeight/2);
			
			var board = new WB.Board({
				commitPane: new WB.Pane({canvas: document.getElementById('canvas'), 
											defaultTransform: defaultTransform}),
				animationPane: new WB.Pane({canvas: document.getElementById('animCanvas'), 
											defaultTransform: defaultTransform}),
				});
			
			var rect = new WB.RectangleShape({
				topleft: {x: 0, y: 0},
				width: 150,
				height: 80
				});

			var player = new WB.Player({board: board});

			var group = new WB.GroupShape({
				transform: new WB.Transform().rotate(WB.Geom.rad(45)),
				shapes: [rect]
			});
			
			player.playAny(rect, function() {
				player.playAny(group);
			});
		}
		
		function arc1() {

			var canvas = document.getElementById('canvas');
			var defaultTransform = new WB.Transform()
				.scale(0.5, 0.5)
				.translate(canvas.width, canvas.height);

			var pane = new WB.Pane({canvas: canvas, defaultTransform: defaultTransform});
			
			var arcA = new WB.PathShape({
					segments: [
						new WB.ArcSegment({
							arc: {
								center: {x: 0, y: 0},
								radiusX: 50,
								radiusY: 50,
								xAxisRotation: 0,
								startAngle: WB.Geom.rad(-70),
								endAngle: WB.Geom.rad(70),
								counterclockwise: false
							}
							})
						]
				});
			arcA.draw(pane);

			var arcB = new WB.PathShape({
					segments: [
						new WB.ArcSegment({
							arc: {
								center: {x: 0, y: 0},
								radiusX: 50,
								radiusY: 50,
								xAxisRotation: 0,
								startAngle: WB.Geom.rad(-80),
								endAngle: WB.Geom.rad(80),
								counterclockwise: true
							}
							})
						]
				});
			arcB.draw(pane);

			var arcC = new WB.PathShape({
					segments: [
						new WB.ArcSegment({
							arc: {
								center: {x: 0, y: 0},
								radiusX: 100,
								radiusY: 50,
								xAxisRotation: 0,
								startAngle: WB.Geom.rad(-70),
								endAngle: WB.Geom.rad(70),
								counterclockwise: false
							}
							})
						]
				});
			arcC.draw(pane);

			var arcD = new WB.PathShape({
					segments: [
						new WB.ArcSegment({
							arc: {
								center: {x: 0, y: 0},
								radiusX: 100,
								radiusY: 50,
								xAxisRotation: WB.Geom.rad(45),
								startAngle: WB.Geom.rad(-70),
								endAngle: WB.Geom.rad(70),
								counterclockwise: false
							}
							})
						]
				});
			arcD.draw(pane);
		}
		
		function arc2() {
			
			var canvas = document.getElementById('canvas');
			var defaultTransform = new WB.Transform();
				//.scale(0.5, 0.5)
				//.translate(canvas.width, canvas.height);

			var pane = new WB.Pane({canvas: canvas, defaultTransform: defaultTransform});
			
			var path = new WB.PathShape({
					segments: [
						new WB.MoveToSegment({point: {x: 10, y: 300}}),
						new WB.LineToSegment({point: {x: 60, y: 275}}),
						new WB.ArcToSvgSegment({
							radiusX: 25, 
							radiusY: 25,
							xAxisRotation: WB.Geom.rad(-30),
							largeArcFlag: 0,
							sweepFlag: 1,
							endPoint: {x: 110, y: 250}
						}),
						new WB.LineToSegment({point: {x: 160, y: 225}}),
						new WB.ArcToSvgSegment({
							radiusX: 25, 
							radiusY: 50,
							xAxisRotation: WB.Geom.rad(-30),
							largeArcFlag: 0,
							sweepFlag: 1,
							endPoint: {x: 210, y: 200}
						}),
						new WB.LineToSegment({point: {x: 260, y: 175}}),
						new WB.ArcToSvgSegment({
							radiusX: 25, 
							radiusY: 75,
							xAxisRotation: WB.Geom.rad(-30),
							largeArcFlag: 0,
							sweepFlag: 1,
							endPoint: {x: 310, y: 150}
						}),
						new WB.LineToSegment({point: {x: 360, y: 125}}),
						new WB.ArcToSvgSegment({
							radiusX: 25, 
							radiusY: 100,
							xAxisRotation: WB.Geom.rad(-30),
							largeArcFlag: 0,
							sweepFlag: 1,
							endPoint: {x: 410, y: 100}
						}),
						new WB.LineToSegment({point: {x: 460, y: 75}})
						]
				});
			path.draw(pane);
		}
		
		function arc2anim() {
			
			// 720 x 405
			var canvasWidth = 720;
			var canvasHeight = 405;
			var realWidth = 1440; // mm
			var realHeight = 810; // mm
			
			var defaultTransform = new WB.Transform();
					//.scale(canvasWidth/realWidth, canvasHeight/realHeight)
					//.translate(realWidth/2, realHeight/2);
			
			var board = new WB.Board({
				commitPane: new WB.Pane({canvas: document.getElementById('canvas'), 
											defaultTransform: defaultTransform}),
				animationPane: new WB.Pane({canvas: document.getElementById('animCanvas'), 
											defaultTransform: defaultTransform}),
				baseVelocity: 100,
				showBounds: false
				});
			
			var path = new WB.PathShape({
					segments: [
						new WB.MoveToSegment({point: {x: 10, y: 300}}),
						new WB.LineToSegment({point: {x: 60, y: 275}}),
						new WB.ArcToSvgSegment({
							radiusX: 25, 
							radiusY: 25,
							xAxisRotation: WB.Geom.rad(-30),
							largeArcFlag: 0,
							sweepFlag: 1,
							endPoint: {x: 110, y: 250}
						}),
						new WB.LineToSegment({point: {x: 160, y: 225}}),
						new WB.ArcToSvgSegment({
							radiusX: 25, 
							radiusY: 50,
							xAxisRotation: WB.Geom.rad(-30),
							largeArcFlag: 0,
							sweepFlag: 1,
							endPoint: {x: 210, y: 200}
						}),
						new WB.LineToSegment({point: {x: 260, y: 175}}),
						new WB.ArcToSvgSegment({
							radiusX: 25, 
							radiusY: 75,
							xAxisRotation: WB.Geom.rad(-30),
							largeArcFlag: 0,
							sweepFlag: 1,
							endPoint: {x: 310, y: 150}
						}),
						new WB.LineToSegment({point: {x: 360, y: 125}}),
						new WB.ArcToSvgSegment({
							radiusX: 25, 
							radiusY: 100,
							xAxisRotation: WB.Geom.rad(-30),
							largeArcFlag: 0,
							sweepFlag: 1,
							endPoint: {x: 410, y: 100}
						}),
						new WB.LineToSegment({point: {x: 460, y: 75}})
						]
				});

			var player = new WB.Player({board: board});

			player.playAny(path);
		}
		
		function cubic1() {
			
			var path = new WB.PathShape({
				segments: [
						new WB.MoveToSegment({point: {x: 126, y: 214}}),
						new WB.CubicSegment({
							cp1: {x: 158, y: 27}, 
							cp2: {x: 33, y: 225}, 
							endPoint: {x: 211, y: 77}
						})
					]
			});

			playAny(path);
		}
		
		function quad1() {
			var path = new WB.PathShape({
				segments: [
						new WB.MoveToSegment({point: {x: 100, y: 100}}),
						new WB.QuadSegment({
							cp: {x: 80, y: 20}, 
							endPoint: {x: 200, y: 200}
						})
					]
			});
			playAny(path);
		}
		
		function cloud1() {
			$.ajax({url: 'cloud.json', contentType: 'application/json'})
				.done(function(json) {
					console.log('got data');
					if (json) {
						if (json.constructor == String) {
							json = JSON.parse(json);
						}
						console.log(json);
						
						var parser = new WB.Parser();
						var shape = parser.parse(json);
						console.log(shape);
						
						var group = new WB.GroupShape({
							transform: new WB.Transform().scale(2, 2),
							shapes: [shape]
						});
						
						playAny(group);
					}
				});
		}
		
		function text1() {
			/*
				+nova_thin_extended.json: multiline but thin and good
				+ArchitectsDaughter.json: multinline, not filled in. ok
				+DK_EarlyMorningCoffee.json: multinline, not filled in. ok
				+FatStore.json: multinline, thin. ok
				+FollowYourDreams.json: multinline, thin. ok
				+mvboli.json: multiline, not filled in. ok.
				+PARTTH_I.json: multiline, thin. too long. ok.
				-alwaysforever.json: multiline
				-alphabetized_cassette_tapes.json: multiline
				-angelina.json: multiline, wrong order
				-Architex.json: multiline, wrong order
				-attack_of_the_cucumbers.json: multiline, wrong order
				-Blokletters-Balpen.json: multiline, wrong order
				-Blokletters-Potlood.json: multiline, wrong order
				-Blokletters-Viltstift.json: multiline, wrong order
				-CamelotDeNada.json: multiline, wrong order
				-daniel.json: multiline, wrong order
				-danielbd.json: multiline, wrong order
				-danielbk.json: multiline, wrong order
				-KGWaystoSayGoodbye.json: multiline, wrong order
				-krazynights.json: multiline, wrong order
				-SingleMalta.json: multiline, wrong order
				-TakeMeOut.json: multiline, wrong order
				-TogetherAgain.json: multiline, wrong order
				-MecSoft-1.json: just wrong
				-Znikomit.json
				-Znikomit2.json
			 */
			$.ajax({
				url: 'service/text/getshape.json',
				data: {
					text: 'Hello World!'
				}
			}).done(function(json) {
				console.log('got data');
				if (json) {
					if (json.constructor == String) {
						json = JSON.parse(json);
					}
					console.log(json);
					
					var parser = new WB.Parser();
					var shape = parser.parse(json);
					console.log(shape);
					
					var scale = 60/shape.height;
					
					var group = new WB.GroupShape({
						shapes: [shape],
						transform: new WB.Transform().translate(10, 10).scale(scale, scale)
					});
					
					group.draw(new WB.Pane({canvas: document.getElementById('canvas')}));
				}
			});
		}

		function text1anim() {
			$.ajax({
				url: 'service/text/getshape.json',
				data: {
					text: 'Hello World!'
				}
			}).done(function(json) {
				console.log('got data');
				if (json) {
					if (json.constructor == String) {
						json = JSON.parse(json);
					}
					console.log(json);
					
					var parser = new WB.Parser();
					var shape = parser.parse(json);
					console.log(shape);
					
					var scale = 60/shape.height;
					
					var group = new WB.GroupShape({
						shapes: [shape],
						transform: new WB.Transform().translate(10, 10).scale(scale, scale)
					});
					
					playAny(group);
				}
			});
		}
		
		function eq1() {
			/*
				eq1: new WB.Transform().scale(3, 3)
				Astrologyisnotscience: new WB.Transform().scale(0.5, 0.5)
				Face-drawing_nevit_098: new WB.Transform().scale(0.5, 0.5).translate(100,50);
				TUX-G2-SVG: new WB.Transform().scale(0.3, 0.3).translate(100,50);
				Woman_Silhouette_51: new WB.Transform().scale(2, 2).translate(100,50);
				
				FEN_bedroom_eyes: new WB.Transform().scale(1, 1)
				FEN_Carl: new WB.Transform().scale(1, 1)
				FEN_frank: new WB.Transform().scale(2, 2)
				FEN_Young_man: new WB.Transform().scale(1, 1)
				liftarn_A_raised_fist: new WB.Transform().scale(0.2, 0.2)
				liftarn_Felix_the_cat: new WB.Transform().scale(1, 1)
				liftarn_Karate_1: new WB.Transform().scale(1, 1)
				molumen_plane_silhouet: new WB.Transform().scale(0.5, 0.5)
				molumen_Tramway: new WB.Transform().scale(0.7, 0.7)
				zeimusu_Swash_ornament: new WB.Transform().translate(100, 100).scale(1, 1)
				liftarn_Adult_and_child: new WB.Transform().translate(100, 100).scale(0.25, 0.25)
				
				ryanlerch_umbrella_outline: new WB.Transform().translate(100, 100).scale(0.25, 0.25)
				ryanlerch_thinkingboy_outline: new WB.Transform().translate(100, 50).scale(0.5, 0.5)
				ryanlerch_boyface8_outline: new WB.Transform().translate(100, 50).scale(0.3, 0.3)
				ryanlerch_boyface3_outline: new WB.Transform().translate(100, 50).scale(0.3, 0.3)
				pitr_Coffee_cup_icon: new WB.Transform().translate(100, 50).scale(1, 1)
				PeterM_Tree: new WB.Transform().translate(100, 50).scale(0.3, 0.3)
				nicubunu_Dog_head_1: new WB.Transform().translate(100, 50).scale(1.5, 1.5)
				molumen_car_outline_modified: new WB.Transform().translate(100, 50).scale(1, 1)
				lalolalo_Smiling_pig: new WB.Transform().translate(100, 50).scale(0.3, 0.3)
				Gioppino_slamdunk_outline: new WB.Transform().translate(100, 50).scale(0.5, 0.5)
				
				chart1: new WB.Transform().translate(100, 50).scale(1, 1);
				cogs1: 
				cogs2:
				ruler2: new WB.Transform().translate(10, 10).scale(0.4, 0.4);
				laurent_amerique_du_sud_politique: new WB.Transform().translate(10, 10).scale(2, 2);
				
				ftjuk_volume: new WB.Transform().translate(10, 10).scale(2, 2)
				eighth_note-down: new WB.Transform().translate(10, 70).scale(0.1, 0.1)
				+qubodup_Public_Domain_Audio_Symbol: new WB.Transform().translate(10, 70).scale(0.1, 0.1)
				+BigRedSmile_Listen..._Ok_: new WB.Transform().translate(10, 70).scale(0.3, 0.3)
				+tom_trumpet
				+Anonymous_Audio_File_Icon: new WB.Transform().translate(10, 70).scale(0.5, 0.5)
				molumen_elephant_silhouet: new WB.Transform().translate(10, 70).scale(0.5, 0.5)
				
				(low) valessiobrito_Coloured_Pencils
				(low) klsgfx_Pencils_5
				
				mbs_ICE-Train: new WB.Transform().translate(10, 70).scale(1, 1)
				yamanotelinetrain: new WB.Transform().translate(10, 10).scale(1, 1)
				train_icon: ??? missed the coord for a line!

				liftarn_Wolf: new WB.Transform().translate(10, 10).scale(0.2, 0.2)
				Peileppe_Wolf: throw away a circle behind or switch it to arc
				choochus_Wolf_Head_Howl_2: new WB.Transform().translate(10, 10).scale(1, 1)

				karderio_computer_screen: new WB.Transform().translate(10, 10).scale(1, 1)
				fortran_minimalist_monitor_and_computer: new WB.Transform().translate(10, 10).scale(1, 1)
				lmproulx_Iphone: new WB.Transform().translate(10, 10).scale(1, 1)
				audio10: new WB.Transform().translate(10, 10).scale(1, 1)
				+audio5
				lemmling_2D_cartoon_elephant: new WB.Transform().translate(10, 10).scale(1, 1)
				pitr_Toy_train_icon: new WB.Transform().translate(10, 10).scale(1, 1)
				
				audio: ??? problem with circles, etc
				audio3: ??? some minor issues
				server: ??? missing rect?
						
				stickman-sleeping-upd: 
			*/
			var name = 'stickman-sleeping-upd';
				var tr = new WB.Transform().translate(100, 100).scale(1, 1);
			$.ajax({url: 'shapes/' + name + '.json', contentType: 'application/json'})
			.done(function(json) {
				console.log('got data');
				if (json) {
					if (json.constructor == String) {
						json = JSON.parse(json);
					}
					console.log(json);
					
					var parser = new WB.Parser();
					var shape = parser.parse(json);
					console.log(shape);
					
					var group = new WB.GroupShape({
						transform: tr,
						shapes: [shape]
					});
					
					group.draw(new WB.Pane({canvas: document.getElementById('canvas')}));
				}
			});
		}

		function eq1anim() {
			var velocity = 10000;
			// 
			var name = 'stickman-sleeping-upd';
			var tr = new WB.Transform().translate(100, 100).scale(1, 1);
			$.ajax({url: 'shapes/' + name + '.json', contentType: 'application/json'})
			.done(function(json) {
				console.log('got data');
				if (json) {
					if (json.constructor == String) {
						json = JSON.parse(json);
					}
					console.log(json);
					
					var parser = new WB.Parser();
					var shape = parser.parse(json);
					console.log(shape);

					var group = new WB.GroupShape({
						transform: tr,
						shapes: [shape]
					});
					
					playAny(group, {
						baseVelocity: velocity
						});
					/*
						framer: function(callback) {
					        	window.setTimeout(callback, 1000);
					        }
					*/
				}
			});
		}
		
		function eq1step() {
			var name = 'molumen_plane_silhouet';
			var tr = new WB.Transform().translate(10, 10).scale(0.25, 0.25);
			$.ajax({url: 'shapes/' + name + '.json', contentType: 'application/json'})
			.done(function(json) {
				console.log('got data');
				if (json) {
					if (json.constructor == String) {
						json = JSON.parse(json);
					}
					console.log(json);
					
					var parser = new WB.Parser();
					var shape = parser.parse(json);
					console.log(shape);

					var group = new WB.GroupShape({
						transform: tr,
						shapes: [shape]
					});
					
					stepAny(group);
				}
			});
		}
		
		function letterH1() {
			$.ajax({url: 'svg/letter-H.json', contentType: 'application/json'})
			.done(function(json) {
				console.log('got data');
				if (json) {
					if (json.constructor == String) {
						json = JSON.parse(json);
					}
					console.log(json);
					
					var parser = new WB.Parser();
					var shape = parser.parse(json);
					console.log(shape);

					var group = new WB.GroupShape({
						transform: new WB.Transform().scale(0.25, 0.25),
						shapes: [shape]
					});
					
					playAny(group);
				}
			});
		}
		
		function speech1() {
			var step1 = new WB.SpeechEpisode({track: 'audio1'});
			
			var step2 = new WB.SpeechEpisode({track: 'speech-1'});
			
			var step3 = new WB.SpeechEndEpisode();
			
			var step4 = new WB.SpeechEpisode({track: 'audio1'});
			
			playAny(new WB.EpisodeList({episodes: [step1, step2, step3, step4]}));
		}
		
		function script1() {
			playScript('script1');
		}

		function script2() {
			playScript('script2');
		}

		function script3() {
			
			/*
			WB.interceptor = function(obj, fnName, fn, args) {
				if (fnName != 'start' && fnName != 'end' && fnName != 'outline') {
					return fn.apply(obj, args);
				}
				
				var s = '' + obj._type;
				console.log(fnName + ': ' + s);
				var ret = fn.apply(obj, args);
				return ret;
			};
			*/
			
			playScript('script3');
		}

		function script1Stepper() {
			stepScript('script1');
		}
		
		function script1Recorder() {
			recordScript('script1');
		}
		
		function eraser1() {
			var pane = new WB.Pane({canvas: document.getElementById('canvas')});
			
			var eraser = new WB.EraserShape({
				eraseAll: true,
				pathSegment: new WB.PathSegment({
					segments: [
						new WB.MoveToSegment({point: {x: 100, y: 200}}),
						new WB.LineToSegment({point: {x: 200, y: 200}}),
						new WB.LineToSegment({point: {x: 250, y: 250}}),
						new WB.LineToSegment({point: {x: 100, y: 300}}),
						new WB.ClosePathSegment()
						]
				})
			});
			
			eraser.draw(pane);
		}
		
		function pan1() {

			// 720 x 405
			var canvasWidth = 720;
			var canvasHeight = 405;
			var realWidth = 1440; // mm
			var realHeight = 810; // mm
			
			var baseVelocity = 500;
			
			var defaultTransform = new WB.Transform();
					//.scale(canvasWidth/realWidth, canvasHeight/realHeight)
					//.translate(realWidth/2, realHeight/2);
			
			var board = new WB.Board({
				commitPane: new WB.Pane({
					canvas: document.getElementById('canvas'), 
					defaultTransform: defaultTransform
					}),
				animationPane: new WB.Pane({
					canvas: document.getElementById('animCanvas'), 
					defaultTransform: defaultTransform
					}),
				baseVelocity: baseVelocity,
				showBounds: false
				});
			
			var player = new WB.Player({board: board});
			bindPlayer(player);

			var name = 'cogs2';
			var tr = new WB.Transform().translate(100, 50).scale(1, 1);
			$.ajax({url: 'shapes/' + name + '.json', contentType: 'application/json'})
			.done(function(json) {
				console.log('got data');
				if (json) {
					if (json.constructor == String) {
						json = JSON.parse(json);
					}
					console.log(json);
					
					var parser = new WB.Parser();
					var shape = parser.parse(json);
					console.log(shape);
					
					var group = new WB.GroupShape({
						transform: tr,
						shapes: [shape]
					});
					
					board.commitShape(group, true);
					
					player.playAny(new WB.EpisodeList({
						episodes: [
							new WB.PanEpisode({point: {x: -200, y: -100}}),
							new WB.PanEpisode({point: {x: 200, y: 100}})
						    ], 
						pause: 100})
					);
				}
			});
		}
		
		function image1() {

			var name = 'funnycat.png';
			var tr = new WB.Transform().translate(20, 20).scale(0.5, 0.5);
			
			var pane = new WB.Pane({canvas: document.getElementById('canvas')});
			
			var image = new Image();
			image.onload = function() {
				
				console.log('image loaded: ' + image.width + ' x ' + image.height);
				
				var shape = new WB.ImageShape({image: image});
				
				var group = new WB.GroupShape({
					transform: tr,
					shapes: [shape]
				});
				
				group.draw(pane);
			};
			image.onerror = function() {
				console.log('image error!');
			};
			image.onabort = function() {
				console.log('image abort!');
			};
			
			image.src = 'images/' + name;
		}

		function image1anim() {

			var name = 'funnycat.png';
			var tr = new WB.Transform().scale(0.5, 0.5);
			
			var pane = new WB.Pane({canvas: document.getElementById('canvas')});
			
			var image = new Image();
			image.onload = function() {
				
				console.log('image loaded: ' + image.width + ' x ' + image.height);
				
				var shape = new WB.ImageShape({image: image});
				
				var group = new WB.GroupShape({
					transform: tr,
					shapes: [shape]
				});
				
				var MovingAnimable = WB.Class.extend('MovingAnimable', {
					
					init: function(shape) {
						this.shape = shape;
					},
					
					createAnimation: function() {
						return new WB.MoveShapeAnimation(this.shape,
								{x:0, y:0}, {x: 300, y: 300});
					}
					
				});
				
				playAny(new MovingAnimable(group));
			};
			image.onerror = function() {
				console.log('image error!');
			};
			image.onabort = function() {
				console.log('image abort!');
			};
			
			image.src = 'images/' + name;
		}
		
	</script>


  </body>
</html>
